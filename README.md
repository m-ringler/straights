# straights

[![.NET Build](https://github.com/m-ringler/straights/actions/workflows/dotnet.yml/badge.svg)](https://github.com/m-ringler/straights/actions/workflows/dotnet.yml)

Solves and generates Straights (or Str8ts) puzzles.

straights accepts both text files (up to 64 x 64) and screenshots (up to 9 x 9) as input.

## Straights Command Line Application

[![License: GPL](https://img.shields.io/badge/License-GPL%203+-yellow.svg)](https://spdx.org/licenses/GPL-3.0-or-later.html)

~~~txt
Description:
  Straights Puzzle Toolkit

Usage:
  straights [command] [options]

Options:
  --version       Show version information
  -?, -h, --help  Show help and usage information

Commands:
  generate                   Generates a straights puzzle
  play <imageOrTextFile>     Plays a straights puzzle in the default browser
  solve <imageOrTextFile>    Solves a straights puzzle []
  edit <imageOrTextFile>     Edits a straights puzzle []
  convert <imageOrTextFile>  Converts a straights puzzle

~~~

Some puzzles generated by the straights command line app can be found in the [test](./test/) folder.

## Straights.Solver

[![NuGet Version](https://img.shields.io/nuget/v/Straights.Solver?label=Straights.Solver)](https://www.nuget.org/packages/Straights.Solver/) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

[Straights.Solver](./Straights.Solver/README.md) is the core library behind the straights command line app and the straights webapp. It solves, generates, and converts
straights puzzles.

Straights.Solver theoretically supports grid sizes up to 64 x 64, but generating grids larger than about 10 x 10 gets increasingly computationally expensive; and I have not generated a grid larger than 13 x 13 yet.

## Straights.Image

 [![NuGet Version](https://img.shields.io/nuget/v/Straights.Image?label=Straights.Image)](https://www.nuget.org/packages/Straights.Image/) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

[Straights.Image](./Straights.Image/README.md) is a library that reads screenshots of Straights and Sudoku grids.
It has no dependency on Straights.Solver or the Straights command line application (it is used by the latter).

It uses [OpenCvSharp](https://github.com/shimat/opencvsharp) to detect the grids, and - on Linux - you may have to build
an appropriate OpenCvSharpExtern.so runtime. See 'Installation' below.

Straights.Image supports grid sizes up to 9 x 9.

## Straights.Web

[![License: GPL](https://img.shields.io/badge/License-GPL%203+-yellow.svg)](https://spdx.org/licenses/GPL-3.0-or-later.html)

[Straights.Web](./Straights.Web/Readme.md) is a Straights webapp that uses Straights.Solver to generate new grids.
Try it online at <https://m-ringler.github.io/straights/>.

With Straights.Web, you can generate up to 10 x 10 grids, and play up to 12 x 12 grids (generated with the web app or with the command line app).

## Status

The code works but is still pre-1.0,
which means that breaking changes in the APIs can happen in every release.
In particular:

* Different releases of the command line app may produce different grids for the same arguments even if you pass an explicit random seed.
* The library APIs are not stable, and may change in every release.
* The data formats used by the webapp may still change.

## Installation

### Windows

Everything should work out of the box.
To use the command line app put it somewhere on your $env:Path. And type `straights` at the command prompt.

The libraries Straights.Image and Straights.Solver are available on nuget.org, and you can use them by adding a package reference to your project.

### Linux

Essentially the same as for windows.

However, the Linux native runtimes of OpenCvSharp used by Straights.Image depend on libraries that need to be installed on the system. These libraries are different for different distributions, e. g. for ubuntu-22.04 and ubuntu-24-04.

If Straights.Image fails with an "Unable to load shared library 'OpenCvSharpExtern' or one of its dependencies." error, you can [check which dependencies are missing](https://github.com/shimat/opencvsharp/issues/1618#issuecomment-1846537140), and install them. Alternatively, you can simply [install all the libraries used to build it](https://github.com/m-ringler/opencvsharp/blob/3bd0b5259f19816f2b35ae02b91303bfee3a04ed/.github/workflows/ubuntu24.yml#L28-L51).

If you are neither on Ubuntu-22 nor on Ubuntu 24, you may have to build your own OpenCvSharpExtern.so and replace the one shipped with straights.

As there is no official OpenCvSharp nuget package for Ubuntu-24, we're using [our own nuget](https://www.nuget.org/packages/m-ringler.OpenCvSharp4.ubuntu24.runtime.linux-x64/) built from [a fork of the OpenCvSharp repo](https://github.com/m-ringler/opencvsharp/) for the Ubuntu-24 build of the straights command line app.

## Building

You'll need a dotnet SDK that matches the SDK version in [global.json](./global.json).

For Straights.Web, you need to download and activate the
[Emscripten SDK](https://emscripten.org/docs/getting_started/downloads.html#sdk-download-and-install).

## Backlog

* Add more XML doc (use Copilot?)
* Microsoft.CodeAnalysis.PublicApiAnalyzers
* Migrate to slnx format
* See if we can find a better solution for the Linux OpenSvSharp runtime.
* publish symbol nuget packages

* Issues/Bugs
  * Digit recognition sometimes fails on 3/5

## Credits

* [Luis Walter](https://github.com/daandtu/Str8ts?search=1): the straights webapp is derived from his.
* [Kshitij Dhama](https://www.kaggle.com/datasets/kshitijdhama/printed-digits-dataset/data): the digit-recognition model in Straights.Image is trained on his printed-digits dataset.
* [Bekhzod Olimov](https://www.kaggle.com/code/killa92/100-accurate-digits-classifier-using-pytorch-timm): the pytorch code used to train the digit-recognition model in Straights.Image is largely his.
